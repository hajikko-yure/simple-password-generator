<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿</title>
  <style>
    body { font-family: sans-serif; padding: 2rem; background: #f0f8ff; }
    input, button { font-size: 1rem; padding: 0.5rem; margin: 0.5rem 0; width: 100%; }
    .output { font-weight: bold; color: #006400; margin-top: 1rem; }
  </style>
</head>
<body>
  <h2>ğŸ” ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿</h2>
  <input id="masterKey" placeholder="ãƒã‚¹ã‚¿ãƒ¼ã‚­ãƒ¼">
  <input id="commonPassword" placeholder="å…±é€šãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰">
  <input id="siteName" placeholder="ã‚µã‚¤ãƒˆåï¼ˆä¾‹: gmail.comï¼‰">
  <button onclick="generate()">ç”Ÿæˆï¼</button>
  <div class="output" id="result"></div>

  <script>
    async function sha256(str) {
      const data = new TextEncoder().encode(str);
      const hashBuffer = await crypto.subtle.digest('SHA-256', data);
      return Array.from(new Uint8Array(hashBuffer)).map(b => b.toString(16).padStart(2, '0')).join('');
    }

    async function sha512(str) {
      const data = new TextEncoder().encode(str);
      const hashBuffer = await crypto.subtle.digest('SHA-512', data);
      return Array.from(new Uint8Array(hashBuffer)).map(b => b.toString(16).padStart(2, '0')).join('');
    }

    async function generate() {
      const master = document.getElementById("masterKey").value;
      const common = document.getElementById("commonPassword").value;
      const site = document.getElementById("siteName").value;

      // ãƒã‚¹ã‚¿ãƒ¼ã‚­ãƒ¼ã‚’æ•°å€¤åŒ–ï¼ˆæ–‡å­—ã‚³ãƒ¼ãƒ‰ã®åˆè¨ˆï¼‰
      const repeat = [...master].reduce((sum, c) => sum + c.charCodeAt(0), 0) % 100;

      // ã‚µã‚¤ãƒˆåã‚’ãƒªãƒ”ãƒ¼ãƒˆãƒãƒƒã‚·ãƒ¥
      let hashed = site;
      for (let i = 0; i < repeat; i++) {
        hashed = await sha256(hashed);
      }

      // base64 â†’ sha512
      const base64 = btoa(hashed);
      const finalHash = await sha512(base64);
      const gen = finalHash.slice(0, 8);  // å…ˆé ­8æ–‡å­—

      const result = common + gen;

      document.getElementById("result").textContent = "ç”Ÿæˆã•ã‚ŒãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰: " + result;
    }
  </script>
</body>
</html>
